<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة بيانات التأشيرات - قاعدة بيانات GitHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        header h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2rem;
            position: relative;
        }
        
        header p {
            text-align: center;
            opacity: 0.9;
            position: relative;
        }
        
        .github-info {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .last-update {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .required::after {
            content: " *";
            color: var(--danger);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input {
            width: auto;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #219955;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .btn-info {
            background-color: var(--info);
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-container input {
            flex: 1;
            margin-left: 10px;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 150px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        .close:hover {
            color: var(--danger);
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .no-data {
            text-align: center;
            padding: 20px;
            color: #777;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab:hover:not(.active) {
            background-color: #f5f5f5;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-card .label {
            color: #777;
            margin-top: 5px;
        }
        
        .requirements-list {
            list-style-type: none;
            padding: 0;
        }
        
        .requirements-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .requirements-list li:last-child {
            border-bottom: none;
        }
        
        .requirements-list li i {
            margin-left: 10px;
            color: var(--success);
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-tourist {
            background-color: #e8f4fd;
            color: var(--secondary);
        }
        
        .badge-business {
            background-color: #e6f7ed;
            color: var(--success);
        }
        
        .badge-student {
            background-color: #fef7e0;
            color: var(--warning);
        }
        
        .badge-medical {
            background-color: #fde8e8;
            color: var(--danger);
        }
        
        .badge-transit {
            background-color: #e6f3f7;
            color: var(--info);
        }
        
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .status-active {
            background-color: var(--success);
        }
        
        .status-inactive {
            background-color: var(--danger);
        }
        
        .github-config {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        
        .config-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }
        
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
                justify-content: center;
            }
            
            .form-section {
                grid-template-columns: 1fr;
            }
            
            .github-info, .last-update {
                position: static;
                margin: 10px auto;
                width: fit-content;
            }
            
            .config-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="github-info">
                <i class="fab fa-github"></i>
                <span id="githubStatus">جار التحميل...</span>
            </div>
            <h1><i class="fas fa-passport"></i> نظام إدارة بيانات التأشيرات - قاعدة بيانات GitHub</h1>
            <p>بيانات موحدة لجميع الموظفين - التحديثات فورية على GitHub</p>
            <div class="last-update">
                <i class="fas fa-clock"></i>
                <span id="lastUpdateText">جار التحميل...</span>
            </div>
        </header>
        
        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-danger" id="errorAlert"></div>
        
        <div class="github-config">
            <h3><i class="fab fa-github"></i> إعدادات اتصال GitHub</h3>
            <div class="config-form">
                <div class="form-group">
                    <label for="githubUrl">رابط ملف JSON على GitHub</label>
                    <input type="text" id="githubUrl" placeholder="https://raw.githubusercontent.com/username/repo/main/trip_data.json">
                </div>
                <button class="btn btn-success" id="loadGithubData"><i class="fas fa-download"></i> تحميل البيانات</button>
            </div>
            <p class="help-text">انسخ رابط الملف الخام (Raw) من GitHub واضغط تحميل البيانات</p>
        </div>
        
        <div class="stats-cards">
            <div class="stat-card">
                <i class="fas fa-globe-americas"></i>
                <div class="value" id="totalCountries">0</div>
                <div class="label">إجمالي الدول</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-file-contract"></i>
                <div class="value" id="totalVisas">0</div>
                <div class="label">إجمالي التأشيرات</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-coins"></i>
                <div class="value" id="avgFees">$0</div>
                <div class="label">متوسط الرسوم</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <div class="value" id="avgProcessing">0</div>
                <div class="label">متوسط مدة المعالجة (أيام)</div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="data-entry"><i class="fas fa-plus-circle"></i> إضافة بيانات</div>
            <div class="tab" data-tab="data-view"><i class="fas fa-table"></i> عرض البيانات</div>
            <div class="tab" data-tab="requirements"><i class="fas fa-tasks"></i> متطلبات شائعة</div>
        </div>
        
        <div class="tab-content active" id="data-entry">
            <div class="card">
                <h2><i class="fas fa-passport"></i> إضافة بيانات تأشيرة جديدة</h2>
                <form id="visaForm">
                    <div class="form-section">
                        <div>
                            <div class="form-group">
                                <label for="country" class="required">الدولة</label>
                                <input type="text" id="country" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="embassy" class="required">السفارة / القنصلية</label>
                                <input type="text" id="embassy" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="visaType" class="required">نوع التأشيرة</label>
                                <select id="visaType" required>
                                    <option value="">اختر نوع التأشيرة</option>
                                    <option value="سياحية">سياحية</option>
                                    <option value="عمل">عمل</option>
                                    <option value="دراسية">دراسية</option>
                                    <option value="علاج">علاج</option>
                                    <option value="عبور">عبور</option>
                                    <option value="دبلوماسية">دبلوماسية</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="processingTime">مدة المعالجة (أيام)</label>
                                <input type="number" id="processingTime" min="1" placeholder="مثال: 14">
                            </div>
                        </div>
                        
                        <div>
                            <div class="form-group">
                                <label for="fees">رسوم التأشيرة ($)</label>
                                <input type="number" id="fees" min="0" step="0.01" placeholder="مثال: 150.00">
                            </div>
                            
                            <div class="form-group">
                                <label for="validity">فترة الصلاحية (أشهر)</label>
                                <input type="number" id="validity" min="1" placeholder="مثال: 6">
                            </div>
                            
                            <div class="form-group">
                                <label for="entryType">نوع الدخول</label>
                                <select id="entryType">
                                    <option value="">اختر نوع الدخول</option>
                                    <option value="مرة واحدة">مرة واحدة</option>
                                    <option value="متعدد الدخول">متعدد الدخول</option>
                                    <option value="مزدوج">مزدوج</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="status">حالة الطلب</label>
                                <select id="status">
                                    <option value="نشط">نشط</option>
                                    <option value="غير نشط">غير نشط</option>
                                    <option value="معلق">معلق</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="requirements">متطلبات التأشيرة الأساسية</label>
                        <div class="checkbox-group" id="basicRequirements">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalRequirements">متطلبات إضافية</label>
                        <textarea id="additionalRequirements" placeholder="أدخل أي متطلبات إضافية للتأشيرة..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">ملاحظات إضافية</label>
                        <textarea id="notes" placeholder="أدخل أي ملاحظات إضافية..."></textarea>
                    </div>
                    
                    <div class="actions">
                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> حفظ البيانات على GitHub</button>
                        <button type="button" class="btn" id="resetForm"><i class="fas fa-broom"></i> تفريغ النموذج</button>
                        <button type="button" class="btn btn-info" id="autoFillBtn"><i class="fas fa-magic"></i> تعبئة تلقائية (تجريبية)</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="tab-content" id="data-view">
            <div class="card">
                <h2><i class="fas fa-table"></i> عرض بيانات التأشيرات من GitHub</h2>
                
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="ابحث عن دولة أو نوع تأشيرة أو سفارة...">
                    <button class="btn" id="searchBtn"><i class="fas fa-search"></i> بحث</button>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterType">تصفية حسب النوع</label>
                        <select id="filterType">
                            <option value="">جميع الأنواع</option>
                            <option value="سياحية">سياحية</option>
                            <option value="عمل">عمل</option>
                            <option value="دراسية">دراسية</option>
                            <option value="علاج">علاج</option>
                            <option value="عبور">عبور</option>
                            <option value="دبلوماسية">دبلوماسية</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterCountry">تصفية حسب الدولة</label>
                        <input type="text" id="filterCountry" placeholder="اسم الدولة">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterStatus">تصفية حسب الحالة</label>
                        <select id="filterStatus">
                            <option value="">جميع الحالات</option>
                            <option value="نشط">نشط</option>
                            <option value="غير نشط">غير نشط</option>
                            <option value="معلق">معلق</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="sortBy">ترتيب حسب</label>
                        <select id="sortBy">
                            <option value="country">الدولة (أ-ي)</option>
                            <option value="countryDesc">الدولة (ي-أ)</option>
                            <option value="fees">الرسوم (منخفضة-عالية)</option>
                            <option value="feesDesc">الرسوم (عالية-منخفضة)</option>
                            <option value="processingTime">مدة المعالجة (قصيرة-طويلة)</option>
                            <option value="processingTimeDesc">مدة المعالجة (طويلة-قصيرة)</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="visaTable">
                        <thead>
                            <tr>
                                <th>الدولة</th>
                                <th>السفارة</th>
                                <th>نوع التأشيرة</th>
                                <th>المتطلبات</th>
                                <th>مدة المعالجة</th>
                                <th>الرسوم ($)</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="visaTableBody">
                            <!-- سيتم ملء هذا القسم بالبيانات من JavaScript -->
                        </tbody>
                    </table>
                    <div class="no-data" id="noDataMessage">لا توجد بيانات لعرضها. يرجى إضافة بيانات جديدة.</div>
                </div>
                
                <div class="actions">
                    <button class="btn" id="refreshData"><i class="fas fa-sync-alt"></i> تحديث البيانات من GitHub</button>
                    <button class="btn" id="exportBtn"><i class="fas fa-file-export"></i> تصدير إلى JSON</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="requirements">
            <div class="card">
                <h2><i class="fas fa-tasks"></i> المتطلبات الشائعة للتأشيرات</h2>
                <div class="form-section">
                    <div>
                        <h3>المتطلبات الأساسية</h3>
                        <ul class="requirements-list" id="commonRequirements">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </ul>
                    </div>
                    <div>
                        <h3>نصائح للحصول على التأشيرة</h3>
                        <ul class="requirements-list" id="visaTips">
                            <!-- سيتم ملؤها بالجافاسكريبت -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- نموذج التعديل -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> تعديل بيانات التأشيرة</h2>
                <span class="close">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-section">
                    <div>
                        <div class="form-group">
                            <label for="editCountry" class="required">الدولة</label>
                            <input type="text" id="editCountry" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editEmbassy" class="required">السفارة / القنصلية</label>
                            <input type="text" id="editEmbassy" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editVisaType" class="required">نوع التأشيرة</label>
                            <select id="editVisaType" required>
                                <option value="">اختر نوع التأشيرة</option>
                                <option value="سياحية">سياحية</option>
                                <option value="عمل">عمل</option>
                                <option value="دراسية">دراسية</option>
                                <option value="علاج">علاج</option>
                                <option value="عبور">عبور</option>
                                <option value="دبلوماسية">دبلوماسية</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editProcessingTime">مدة المعالجة (أيام)</label>
                            <input type="number" id="editProcessingTime" min="1">
                        </div>
                    </div>
                    
                    <div>
                        <div class="form-group">
                            <label for="editFees">رسوم التأشيرة ($)</label>
                            <input type="number" id="editFees" min="0" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="editValidity">فترة الصلاحية (أشهر)</label>
                            <input type="number" id="editValidity" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="editEntryType">نوع الدخول</label>
                            <select id="editEntryType">
                                <option value="">اختر نوع الدخول</option>
                                <option value="مرة واحدة">مرة واحدة</option>
                                <option value="متعدد الدخول">متعدد الدخول</option>
                                <option value="مزدوج">مزدوج</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editStatus">حالة الطلب</label>
                            <select id="editStatus">
                                <option value="نشط">نشط</option>
                                <option value="غير نشط">غير نشط</option>
                                <option value="معلق">معلق</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editRequirements">متطلبات التأشيرة الأساسية</label>
                    <div class="checkbox-group" id="editBasicRequirements">
                        <!-- سيتم ملؤها بالجافاسكريبت -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editAdditionalRequirements">متطلبات إضافية</label>
                    <textarea id="editAdditionalRequirements" placeholder="أدخل أي متطلبات إضافية للتأشيرة..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editNotes">ملاحظات إضافية</label>
                    <textarea id="editNotes" placeholder="أدخل أي ملاحظات إضافية..."></textarea>
                </div>
                
                <div class="actions">
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> حفظ التعديلات على GitHub</button>
                    <button type="button" class="btn btn-danger" id="cancelEdit"><i class="fas fa-times"></i> إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // بيانات التطبيق
        let visaData = [];
        let currentEditId = null;
        let githubFileUrl = '';
        
        // متطلبات التأشيرة الأساسية
        const basicRequirementsList = [
            "جواز سفر ساري المفعول",
            "صور شخصية",
            "نموذج طلب تأشيرة مكتمل",
            "حجز فندق",
            "تذكرة طيران ذهاب وعودة",
            "كشف حساب بنكي",
            "تأمين صحي",
            "شهادة عمل",
            "دعوة رسمية (إن وجدت)",
            "سجل عدلي"
        ];
        
        // المتطلبات الشائعة
        const commonRequirements = [
            "تأكد من صلاحية جواز سفرك (6 أشهر على الأقل)",
            "احصل على صور شخصية وفقاً للمواصفات المطلوبة",
            "احفظ نسخة من جميع المستندات المقدمة",
            "تأكد من دقة المعلومات في نموذج الطلب",
            "احصل على التأمين الصحي المناسب",
            "تأكد من توفر الأموال الكافية لإثبات الإقامة"
        ];
        
        // نصائح للحصول على التأشيرة
        const visaTips = [
            "قدم الطلب قبل موعد السفر بفترة كافية",
            "راجع المتطلبات المحددة للدولة التي تريد زيارتها",
            "كن صادقاً ودقيقاً في تقديم المعلومات",
            "احتفظ بسجل سفر جيد (للمسافرين الدائمين)",
            "استشر مكتب التأشيرات أو سفارة الدولة للاستفسارات",
            "تأكد من أن جميع المستندات مترجمة إذا لزم الأمر"
        ];
        
        // عناصر DOM
        const visaForm = document.getElementById('visaForm');
        const editForm = document.getElementById('editForm');
        const visaTableBody = document.getElementById('visaTableBody');
        const noDataMessage = document.getElementById('noDataMessage');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const filterType = document.getElementById('filterType');
        const filterCountry = document.getElementById('filterCountry');
        const filterStatus = document.getElementById('filterStatus');
        const sortBy = document.getElementById('sortBy');
        const exportBtn = document.getElementById('exportBtn');
        const refreshDataBtn = document.getElementById('refreshData');
        const loadGithubDataBtn = document.getElementById('loadGithubData');
        const githubUrlInput = document.getElementById('githubUrl');
        const editModal = document.getElementById('editModal');
        const resetFormBtn = document.getElementById('resetForm');
        const autoFillBtn = document.getElementById('autoFillBtn');
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const basicRequirementsContainer = document.getElementById('basicRequirements');
        const editBasicRequirementsContainer = document.getElementById('editBasicRequirements');
        const commonRequirementsContainer = document.getElementById('commonRequirements');
        const visaTipsContainer = document.getElementById('visaTips');
        const githubStatus = document.getElementById('githubStatus');
        const lastUpdateText = document.getElementById('lastUpdateText');
        
        // إحصائيات
        const totalCountriesElement = document.getElementById('totalCountries');
        const totalVisasElement = document.getElementById('totalVisas');
        const avgFeesElement = document.getElementById('avgFees');
        const avgProcessingElement = document.getElementById('avgProcessing');

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            initializeRequirements();
            
            // تحميل إعدادات GitHub المحفوظة
            const savedGithubUrl = localStorage.getItem('github_visa_url');
            if (savedGithubUrl) {
                githubUrlInput.value = savedGithubUrl;
                githubFileUrl = savedGithubUrl;
                loadDataFromGitHub();
            }
            
            // إضافة مستمعي الأحداث
            visaForm.addEventListener('submit', handleFormSubmit);
            editForm.addEventListener('submit', handleEditSubmit);
            searchBtn.addEventListener('click', handleSearch);
            filterType.addEventListener('change', renderTable);
            filterCountry.addEventListener('input', renderTable);
            filterStatus.addEventListener('change', renderTable);
            sortBy.addEventListener('change', renderTable);
            exportBtn.addEventListener('click', handleExport);
            refreshDataBtn.addEventListener('click', loadDataFromGitHub);
            loadGithubDataBtn.addEventListener('click', handleLoadGithubData);
            resetFormBtn.addEventListener('click', resetForm);
            autoFillBtn.addEventListener('click', autoFillForm);
            
            // إغلاق النماذج
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            document.getElementById('cancelEdit').addEventListener('click', function() {
                editModal.style.display = 'none';
            });
            
            // التبديل بين التبويبات
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // إزالة النشاط من جميع التبويبات والمحتويات
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // إضافة النشاط للتبويب والمحتوى المحدد
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        });
        
        // تهيئة متطلبات التأشيرة
        function initializeRequirements() {
            // تهيئة المتطلبات الأساسية في نموذج الإضافة
            basicRequirementsContainer.innerHTML = basicRequirementsList.map(req => `
                <div class="checkbox-item">
                    <input type="checkbox" id="req_${basicRequirementsList.indexOf(req)}" value="${req}">
                    <label for="req_${basicRequirementsList.indexOf(req)}">${req}</label>
                </div>
            `).join('');
            
            // تهيئة المتطلبات الأساسية في نموذج التعديل
            editBasicRequirementsContainer.innerHTML = basicRequirementsList.map(req => `
                <div class="checkbox-item">
                    <input type="checkbox" id="edit_req_${basicRequirementsList.indexOf(req)}" value="${req}">
                    <label for="edit_req_${basicRequirementsList.indexOf(req)}">${req}</label>
                </div>
            `).join('');
            
            // تهيئة المتطلبات الشائعة
            commonRequirementsContainer.innerHTML = commonRequirements.map(req => `
                <li><i class="fas fa-check-circle"></i> ${req}</li>
            `).join('');
            
            // تهيئة نصائح التأشيرة
            visaTipsContainer.innerHTML = visaTips.map(tip => `
                <li><i class="fas fa-lightbulb"></i> ${tip}</li>
            `).join('');
        }
        
        // معالجة إرسال النموذج
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!githubFileUrl) {
                showAlert('يرجى إعداد رابط ملف GitHub أولاً', 'error');
                return;
            }
            
            // جمع المتطلبات المحددة
            const selectedRequirements = [];
            basicRequirementsContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                selectedRequirements.push(checkbox.value);
            });
            
            const newVisa = {
                id: Date.now().toString(),
                country: document.getElementById('country').value,
                embassy: document.getElementById('embassy').value,
                visaType: document.getElementById('visaType').value,
                requirements: selectedRequirements,
                additionalRequirements: document.getElementById('additionalRequirements').value,
                processingTime: document.getElementById('processingTime').value,
                fees: document.getElementById('fees').value,
                validity: document.getElementById('validity').value,
                entryType: document.getElementById('entryType').value,
                status: document.getElementById('status').value,
                notes: document.getElementById('notes').value,
                createdAt: new Date().toISOString(),
                createdBy: 'المسؤول'
            };
            
            visaData.push(newVisa);
            saveDataToGitHub();
            resetForm();
            showAlert('تم إضافة بيانات التأشيرة بنجاح وحفظها على GitHub', 'success');
            
            // الانتقال إلى تبويب العرض
            switchToTab('data-view');
        }
        
        // معالجة تعديل النموذج
        function handleEditSubmit(e) {
            e.preventDefault();
            
            if (!githubFileUrl) {
                showAlert('يرجى إعداد رابط ملف GitHub أولاً', 'error');
                return;
            }
            
            const index = visaData.findIndex(item => item.id === currentEditId);
            if (index !== -1) {
                // جمع المتطلبات المحددة
                const selectedRequirements = [];
                editBasicRequirementsContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedRequirements.push(checkbox.value);
                });
                
                visaData[index] = {
                    ...visaData[index],
                    country: document.getElementById('editCountry').value,
                    embassy: document.getElementById('editEmbassy').value,
                    visaType: document.getElementById('editVisaType').value,
                    requirements: selectedRequirements,
                    additionalRequirements: document.getElementById('editAdditionalRequirements').value,
                    processingTime: document.getElementById('editProcessingTime').value,
                    fees: document.getElementById('editFees').value,
                    validity: document.getElementById('editValidity').value,
                    entryType: document.getElementById('editEntryType').value,
                    status: document.getElementById('editStatus').value,
                    notes: document.getElementById('editNotes').value,
                    updatedAt: new Date().toISOString(),
                    updatedBy: 'المسؤول'
                };
                
                saveDataToGitHub();
                editModal.style.display = 'none';
                showAlert('تم تحديث بيانات التأشيرة بنجاح وحفظها على GitHub', 'success');
            }
        }
        
        // تحميل البيانات من GitHub
        function handleLoadGithubData() {
            const url = githubUrlInput.value.trim();
            if (!url) {
                showAlert('يرجى إدخال رابط ملف JSON على GitHub', 'error');
                return;
            }
            
            // حفظ الرابط للإستخدام المستقبلي
            githubFileUrl = url;
            localStorage.setItem('github_visa_url', url);
            
            loadDataFromGitHub();
        }
        
        // تحميل البيانات من GitHub
        function loadDataFromGitHub() {
            if (!githubFileUrl) {
                showAlert('يرجى إعداد رابط ملف GitHub أولاً', 'error');
                return;
            }
            
            githubStatus.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> جاري تحميل البيانات...';
            
            fetch(githubFileUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('فشل في تحميل البيانات من GitHub');
                    }
                    return response.json();
                })
                .then(data => {
                    visaData = Array.isArray(data) ? data : [];
                    renderTable();
                    updateStats();
                    updateLastUpdateTime();
                    githubStatus.innerHTML = '<i class="fas fa-check-circle"></i> متصل بقاعدة البيانات';
                    showAlert('تم تحميل البيانات بنجاح من GitHub', 'success');
                })
                .catch(error => {
                    console.error('Error loading data from GitHub:', error);
                    githubStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> فشل في التحميل';
                    showAlert('فشل في تحميل البيانات من GitHub: ' + error.message, 'error');
                });
        }
        
        // حفظ البيانات إلى GitHub (محاكاة - تحتاج إلى GitHub API في التطبيق الحقيقي)
        function saveDataToGitHub() {
            // في التطبيق الحقيقي، هنا نستخدم GitHub API لحفظ البيانات
            // لكن هذا يتطلب token وتفاصيل مستخدم
            
            // بدلاً من ذلك، سنقوم بمحاكاة الحفظ وعرض التعليمات
            
            githubStatus.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> جاري الحفظ على GitHub...';
            
            // محاكاة عملية الحفظ
            setTimeout(() => {
                // حفظ البيانات محلياً (بديل عن GitHub في هذا المثال)
                localStorage.setItem('visa_data_backup', JSON.stringify(visaData));
                
                renderTable();
                updateStats();
                updateLastUpdateTime();
                githubStatus.innerHTML = '<i class="fas fa-check-circle"></i> تم الحفظ على GitHub';
                
                // عرض تعليمات للحفظ الفعلي على GitHub
                showGitHubSaveInstructions();
            }, 1500);
        }
        
        // عرض تعليمات حفظ البيانات على GitHub
        function showGitHubSaveInstructions() {
            const dataStr = JSON.stringify(visaData, null, 2);
            const instructions = `
لحفظ البيانات فعلياً على GitHub، يرجى اتباع الخطوات التالية:

1. انسخ البيانات التالية:
\`\`\`json
${dataStr}
\`\`\`

2. اذهب إلى ملف trip_data.json في مستودع GitHub الخاص بك
3. انقر على زر "Edit" (قلم التعديل)
4. استبدل المحتوى الحالي بالبيانات أعلاه
5. انزل إلى أسفل الصفحة وأضف رسالة commit مثل "تحديث بيانات التأشيرات"
6. انقر على "Commit changes"

بهذه الطريقة سيتم حفظ البيانات على GitHub ويمكن للموظفين رؤيتها فوراً.
            `;
            
            alert(instructions);
        }
        
        // عرض الجدول
        function renderTable() {
            let filteredData = [...visaData];
            
            // التصفية حسب البحث
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.country.toLowerCase().includes(searchTerm) || 
                    item.visaType.toLowerCase().includes(searchTerm) ||
                    item.embassy.toLowerCase().includes(searchTerm)
                );
            }
            
            // التصفية حسب النوع
            const typeFilter = filterType.value;
            if (typeFilter) {
                filteredData = filteredData.filter(item => item.visaType === typeFilter);
            }
            
            // التصفية حسب الدولة
            const countryFilter = filterCountry.value.toLowerCase();
            if (countryFilter) {
                filteredData = filteredData.filter(item => 
                    item.country.toLowerCase().includes(countryFilter)
                );
            }
            
            // التصفية حسب الحالة
            const statusFilter = filterStatus.value;
            if (statusFilter) {
                filteredData = filteredData.filter(item => item.status === statusFilter);
            }
            
            // الترتيب
            const sortOption = sortBy.value;
            switch(sortOption) {
                case 'country':
                    filteredData.sort((a, b) => a.country.localeCompare(b.country));
                    break;
                case 'countryDesc':
                    filteredData.sort((a, b) => b.country.localeCompare(a.country));
                    break;
                case 'fees':
                    filteredData.sort((a, b) => (parseFloat(a.fees) || 0) - (parseFloat(b.fees) || 0));
                    break;
                case 'feesDesc':
                    filteredData.sort((a, b) => (parseFloat(b.fees) || 0) - (parseFloat(a.fees) || 0));
                    break;
                case 'processingTime':
                    filteredData.sort((a, b) => (parseInt(a.processingTime) || 0) - (parseInt(b.processingTime) || 0));
                    break;
                case 'processingTimeDesc':
                    filteredData.sort((a, b) => (parseInt(b.processingTime) || 0) - (parseInt(a.processingTime) || 0));
                    break;
            }
            
            // عرض البيانات
            if (filteredData.length === 0) {
                visaTableBody.innerHTML = '';
                noDataMessage.style.display = 'block';
            } else {
                noDataMessage.style.display = 'none';
                visaTableBody.innerHTML = filteredData.map(item => `
                    <tr>
                        <td>${item.country}</td>
                        <td>${item.embassy}</td>
                        <td><span class="badge badge-${getBadgeClass(item.visaType)}">${item.visaType}</span></td>
                        <td>${item.requirements ? item.requirements.slice(0, 3).join('، ') + (item.requirements.length > 3 ? '...' : '') : ''}</td>
                        <td>${item.processingTime ? item.processingTime + ' يوم' : ''}</td>
                        <td>${item.fees ? '$' + item.fees : ''}</td>
                        <td>
                            ${item.status}
                            <span class="status-indicator status-${item.status === 'نشط' ? 'active' : 'inactive'}"></span>
                        </td>
                        <td>
                            <button class="btn btn-warning" onclick="editVisa('${item.id}')"><i class="fas fa-edit"></i> تعديل</button>
                            <button class="btn btn-danger" onclick="deleteVisa('${item.id}')"><i class="fas fa-trash"></i> حذف</button>
                            <button class="btn btn-info" onclick="viewDetails('${item.id}')"><i class="fas fa-eye"></i> تفاصيل</button>
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        // الحصول على فئة البادج حسب نوع التأشيرة
        function getBadgeClass(visaType) {
            switch(visaType) {
                case 'سياحية': return 'tourist';
                case 'عمل': return 'business';
                case 'دراسية': return 'student';
                case 'علاج': return 'medical';
                case 'عبور': return 'transit';
                default: return 'tourist';
            }
        }
        
        // تعديل تأشيرة
        function editVisa(id) {
            const visa = visaData.find(item => item.id === id);
            if (visa) {
                currentEditId = id;
                document.getElementById('editCountry').value = visa.country;
                document.getElementById('editEmbassy').value = visa.embassy;
                document.getElementById('editVisaType').value = visa.visaType;
                document.getElementById('editProcessingTime').value = visa.processingTime || '';
                document.getElementById('editFees').value = visa.fees || '';
                document.getElementById('editValidity').value = visa.validity || '';
                document.getElementById('editEntryType').value = visa.entryType || '';
                document.getElementById('editStatus').value = visa.status || 'نشط';
                document.getElementById('editAdditionalRequirements').value = visa.additionalRequirements || '';
                document.getElementById('editNotes').value = visa.notes || '';
                
                // تفريغ جميع المربعات أولاً
                editBasicRequirementsContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // تحديد المتطلبات المحددة مسبقاً
                if (visa.requirements && Array.isArray(visa.requirements)) {
                    visa.requirements.forEach(req => {
                        const index = basicRequirementsList.indexOf(req);
                        if (index !== -1) {
                            document.getElementById(`edit_req_${index}`).checked = true;
                        }
                    });
                }
                
                editModal.style.display = 'flex';
            }
        }
        
        // حذف تأشيرة
        function deleteVisa(id) {
            if (confirm('هل أنت متأكد من حذف هذه البيانات؟')) {
                visaData = visaData.filter(item => item.id !== id);
                saveDataToGitHub();
                showAlert('تم حذف بيانات التأشيرة بنجاح', 'success');
            }
        }
        
        // عرض التفاصيل
        function viewDetails(id) {
            const visa = visaData.find(item => item.id === id);
            if (visa) {
                const requirementsList = visa.requirements && visa.requirements.length > 0 
                    ? visa.requirements.map(req => `• ${req}`).join('\n') 
                    : 'لا توجد متطلبات محددة';
                
                const details = `
الدولة: ${visa.country}
السفارة/القنصلية: ${visa.embassy}
نوع التأشيرة: ${visa.visaType}
نوع الدخول: ${visa.entryType || 'غير محدد'}
المتطلبات الأساسية:
${requirementsList}
${visa.additionalRequirements ? `متطلبات إضافية: ${visa.additionalRequirements}` : ''}
مدة المعالجة: ${visa.processingTime ? visa.processingTime + ' يوم' : 'غير محدد'}
الرسوم: ${visa.fees ? '$' + visa.fees : 'غير محدد'}
فترة الصلاحية: ${visa.validity ? visa.validity + ' شهر' : 'غير محدد'}
الحالة: ${visa.status}
${visa.notes ? `ملاحظات: ${visa.notes}` : ''}
                `;
                alert(details);
            }
        }
        
        // معالجة البحث
        function handleSearch() {
            renderTable();
        }
        
        // تصدير البيانات
        function handleExport() {
            const dataStr = JSON.stringify(visaData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'trip_data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('تم تصدير البيانات إلى trip_data.json بنجاح', 'success');
        }
        
        // تفريغ النموذج
        function resetForm() {
            visaForm.reset();
            // تفريغ جميع المربعات
            basicRequirementsContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }
        
        // تعبئة تلقائية للنموذج (لأغراض التجربة)
        function autoFillForm() {
            document.getElementById('country').value = 'تركيا';
            document.getElementById('embassy').value = 'السفارة التركية في الرياض';
            document.getElementById('visaType').value = 'سياحية';
            document.getElementById('processingTime').value = '10';
            document.getElementById('fees').value = '60';
            document.getElementById('validity').value = '3';
            document.getElementById('entryType').value = 'متعدد الدخول';
            document.getElementById('status').value = 'نشط';
            document.getElementById('additionalRequirements').value = 'حجز فندق مؤكد وتذكرة طيران';
            document.getElementById('notes').value = 'يمكن الحصول على التأشيرة الإلكترونية أيضاً';
            
            // تحديد بعض المتطلبات
            document.getElementById('req_0').checked = true;
            document.getElementById('req_1').checked = true;
            document.getElementById('req_2').checked = true;
            document.getElementById('req_4').checked = true;
            document.getElementById('req_5').checked = true;
            
            showAlert('تم تعبئة النموذج تلقائياً بنموذج تجريبي', 'success');
        }
        
        // تحديث وقت التحديث الأخير
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA');
            const dateString = now.toLocaleDateString('ar-SA');
            lastUpdateText.textContent = `آخر تحديث: ${timeString} - ${dateString}`;
        }
        
        // تحديث الإحصائيات
        function updateStats() {
            const countries = [...new Set(visaData.map(item => item.country))];
            totalCountriesElement.textContent = countries.length;
            totalVisasElement.textContent = visaData.length;
            
            // متوسط الرسوم
            const totalFees = visaData.reduce((sum, item) => sum + (parseFloat(item.fees) || 0), 0);
            const avgFees = visaData.length > 0 ? (totalFees / visaData.length).toFixed(2) : 0;
            avgFeesElement.textContent = `$${avgFees}`;
            
            // متوسط مدة المعالجة
            const totalProcessing = visaData.reduce((sum, item) => sum + (parseInt(item.processingTime) || 0), 0);
            const avgProcessing = visaData.length > 0 ? Math.round(totalProcessing / visaData.length) : 0;
            avgProcessingElement.textContent = avgProcessing;
        }
        
        // عرض التنبيهات
        function showAlert(message, type) {
            const alert = type === 'success' ? successAlert : errorAlert;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // التبديل إلى تبويب معين
        function switchToTab(tabId) {
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(tc => tc.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
    </script>
</body>
</html>
